!function(e,n,t){function i(n){var t=e.ImageKitSettings.translations[n];return void 0!==t?t:"["+n+"]"}function a(e){for(var n=e.concat(),t=0;t<n.length;++t)for(var i=t+1;i<n.length;++i)n[t]===n[i]&&n.splice(i--,1);return n}function r(e){function n(e,n,i,a){a=a||"GET",i=i||{},n=n||function(){};var r=m.api+e;return t.ajax({url:r,dataType:"json",method:a,data:i,success:function(e){n(e)},error:function(e,n,t){m.error(e.responseJSON)}})}function i(e){p=e}function r(){p=!1}function c(e){return void 0===e?p:p===e}function o(e){return n("status",e)}function u(e){return g(),i(b),n(b,function(n){r(b),e(n.data)})}function s(e,t){function a(){n(k,function(n){n.data.pending>0&&!f()?(e(n.data),a()):(r(k),t(n.data))})}g(),i(k),e=e||function(){},t=t||function(){},a()}function l(e,c,o){g(),i(h),e=e||function(){},c=c||function(){},o=o||function(){},n(h,function(n){var i=0,u=n.data,s=function(){t.ajax({url:u[i],headers:{"X-ImageKit-Indexing":1},success:function(n){n.data.links.length>0&&(u=a(u.concat(n.data.links))),++i>=u.length||f()?(r(h),c({total:u.length,status:n.data.status})):(e({current:i,total:u.length,url:u[i],status:n.data.status}),s())},error:function(e){o(e.responseJSON)}})};s()})}function d(){v=!0}function f(){return v}function g(){p=!1,v=!1}var m=t.extend({error:function(e){console.error(e.message)}},e),p=!1,v=!1,k="create",b="clear",h="index";return{status:o,clear:u,create:s,index:l,cancel:d,cancelled:f,running:c,reset:g}}function c(){function e(e){return e===l?d:(u.classList[e?"remove":"add"]("is-hidden"),l=e,f)}function t(){return u.classList.add("is-disabled"),f}function i(){return u.classList.remove("is-disabled"),f}function a(){return e(!0)}function r(){return e(!1)}function c(e){return null!==e&&e!==!1?u.setAttribute("value",e):u.removeAttribute("value"),f}function o(e){return e?(s.innerHTML=e,f):s.innerHTML}var u=n.querySelector(".js-imagekit-progress"),s=n.querySelector(".js-imagekit-progress-text"),l=!1,d=this,f={};return f={show:a,hide:r,value:c,text:o,enable:i,disable:t}}function o(){function e(e){return e?c[e].element.addClass("imagekit-action--disabled"):t.each(c,function(){this.element.addClass("imagekit-action--disabled")}),r}function n(e){return e?c[e].element.removeClass("imagekit-action--disabled"):t.each(c,function(){this.element.removeClass("imagekit-action--disabled")}),r}function i(e,n,t){var i=c[e].icon;return i.removeClass(n),i.addClass(t),r}function a(e,n){return c[e].element.click(function(e){e.preventDefault(),n()}),r}var r={},c={clear:{element:t('[href="#imagekit-action-clear"]'),icon:t('[href="#imagekit-action-clear"] i')},create:{element:t('[href="#imagekit-action-create"]'),icon:t('[href="#imagekit-action-create"] i')}};return r={disable:e,enable:n,icon:i,register:a}}function u(e){function a(e){b.innerHTML=e.created,h.innerHTML=e.pending}function u(e,n){n=n||!1,k.disable(),w.disable();var i=t("<div/>").addClass("imagekit-modal");i.append('<i class="imagekit-error-icon">'),i.append(t("<p/>").html(e)),t("#imagekit-widget").append(i),n&&i.append(t('<a href="#" class="btn btn-rounded">OK</a>').click(function(){i.remove(),v.reset(),w.hide(),k.enable().icon("create","fa-stop-circle-o","fa-play-circle-o"),l(),n()}))}function s(e,a){var r,c,o=t("<div/>").addClass("imagekit-modal");o.append(t("<p/>").html(e)),t("#imagekit-widget").append(o),r=function(e){("key"in e?"Escape"==e.key||"Esc"==e.key:27==e.keyCode)?c(!1):("key"in e?"Enter"==e.key:13==e.key)&&c(!0)},c=function(e){o.remove(),a(e),n.removeEventListener("keydown",r)};var u=t('<p class="imagekit-modal-buttons"/>');u.append(t('<a href="#" class="btn btn-rounded">'+i("cancel")+"</a>").click(function(){c(!1)})),u.append("&nbsp;&nbsp;&nbsp;"),u.append(t('<a href="#" class="btn btn-rounded">'+i("ok")+"</a>").click(function(){c(!0)})),o.append(u),n.addEventListener("keydown",r)}function l(){v.running()||v.status(function(e){a(e.data)})}function d(){v.running()||s(i("imagekit.widget.clear.confirm"),function(e){e&&(k.disable(),w.value(!1).text(i("imagekit.widget.progress.clearing")).show(),v.clear(function(e){w.hide(),k.enable(),a(e)}))})}function f(e){e=e||function(){},w.text(i("imagekit.widget.progress.scanning")),v.index(function(e){w.value(e.current/e.total).text(i("imagekit.widget.progress.scanning")+" "+e.current+"/"+e.total),a(e.status)},function(n){w.value(1).text(i("imagekit.widget.progress.scanned")),a(n.status),e()},function(e){u(e.message,function(){})})}function g(e){e=e||function(){},w.value(!1).text(i("imagekit.widget.progress.creating")),v.create(function(e){var n=e.pending+e.created;w.value(e.created/n),a(e)},function(n){w.value(1),a(n),e()})}function m(){function e(){w.hide(),k.enable().icon("create","fa-stop-circle-o","fa-play-circle-o")}k.disable("clear").icon("create","fa-play-circle-o","fa-stop-circle-o"),w.value(!1).show(),ImageKitSettings.discover?f(function(){v.cancelled()?e():g(e)}):g(e)}function p(){if(v.running("index")||v.running("create"))return k.disable(),w.value(!1).text(i("imagekit.widget.progress.cancelling")),void v.cancel()}var v=new r(t.extend(ImageKitSettings,{error:function(e){u(e.message)}})),k=new o,b=(n.querySelector(".js-imagekit-info"),n.querySelector(".js-imagekit-created")),h=n.querySelector(".js-imagekit-pending"),w=new c;return k.register("clear",d),k.register("create",function(){v.running()?p():m()}),{status:l}}t(function(){var e=new u;e.status()})}(window,document,jQuery);